@if (isAuthenticated()) {
  <div class="h-screen w-screen flex bg-slate-100 dark:bg-gradient-to-br dark:from-slate-900 dark:to-slate-700 overflow-hidden">
    <!-- Sidebar Container -->
    <div 
      class="fixed inset-y-0 left-0 z-40 w-64 transform transition-transform duration-300 ease-in-out md:relative md:translate-x-0"
      [class.-translate-x-full]="!isSidebarOpen()"
    >
      <app-sidebar [currentView]="currentView()" (navigate)="changeView($event)" />
    </div>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
      
      <!-- Mobile Header -->
      <header class="md:hidden flex items-center justify-between bg-white dark:bg-primary shadow p-4 z-20">
        <button (click)="toggleSidebar()" class="text-slate-500 dark:text-slate-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <h1 class="text-lg font-bold">{{ currentViewLabel() }}</h1>
        <div class="w-6"></div> <!-- Spacer to balance the title -->
      </header>

      <!-- Content -->
      <main class="flex-1 overflow-y-auto">
        <router-outlet></router-outlet>
      </main>
    </div>

    <!-- Overlay for mobile sidebar -->
    @if(isSidebarOpen()) {
      <div (click)="closeSidebar()" class="md:hidden fixed inset-0 bg-black bg-opacity-50 z-30"></div>
    }
    
    <app-chatbot (navigateTo)="changeView($event)" />
    @if(isCommandPaletteOpen()) {
      <app-command-palette 
        (close)="closeCommandPalette()" 
        (command)="handleCommand($event)"
      />
    }
  </div>
} @else {
  <router-outlet></router-outlet>
}

<app-toast-container />
